<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Events</title>
    <script src="jquery-2.2.0.js"></script>
    <script src="lodash.js"></script>
    <script src="myAngular.js"></script>
    <script>
        console.log("Publish-Subscribe Messaging");
        console.log("Events");
        var parent = new Scope();
        var scope = parent.$new();
        var child = scope.$new();
        var isolatedChild = scope.$new(true);
        console.log("allows registering listeners");
        (function () {
            //var listener1 = function () { };
            //var listener2 = function () { };
            //var listener3 = function () { };

            //scope.$on("someEvent", listener1);
            //scope.$on("someEvent", listener2);
            //scope.$on("someOtherEvent", listener3);

            //console.log(_.isEqual(scope.$$listeners, {
            //    someEvent: [listener1, listener2],
            //    someOtherEvent: [listener3]
            //}));
        })();
        console.log("registers different listeners for every scope");
        (function () {
            //var listener1 = function () { };
            //var listener2 = function () { };
            //var listener3 = function () { };

            //scope.$on("someEvent", listener1);
            //child.$on("someEvent", listener2);
            //isolatedChild.$on("someEvent", listener3);

            //console.log(_.isEqual(scope.$$listeners, { someEvent: [listener1] }));
            //console.log(_.isEqual(child.$$listeners, { someEvent: [listener2] }));
            //console.log(_.isEqual(isolatedChild.$$listeners, { someEvent: [listener3] }));
        })();
        console.log("The basics of $emit and $broadcast");
        console.log("calls the listeners of the matching event on $emit");
        (function () {
            //scope.$on("someEvent", function () { console.log("someEvent被调用"); });
            //scope.$on("someOtherEvent", function () { console.log("someOtherEvent被调用"); });

            //scope.$emit("someEvent");
        })();
        console.log("calls the listeners of the matching event on $broadcast");
        (function () {
            //scope.$on("someEvent", function () { console.log("someEvent被调用"); });
            //scope.$on("someOtherEvent", function () { console.log("someOtherEvent被调用"); });

            //scope.$broadcast("someEvent");
        })();
        //_.forEach(["$emit", "$broadcast"], function (method) {
        //    console.log("calls listeners registered for matching events on " + method);
        //    (function () {
        //        scope.$on("someEvent", function () { console.log("someEvent被触发"); });
        //        scope.$on("someOtherEvent", function () { console.log("someOtherEvent被触发"); });

        //        scope[method]("someEvent");
        //    })();
        //});
        console.log("Event Objects");
        console.log("passes additional arguments to listeners on $emit");
        //(function () {
        //    scope.$on("someEvent", function () { console.log("someEvent被触发", arguments); });

        //    scope.$emit("someEvent", "and", ["addtional", "arguments"]);
        //})();
        console.log("Returning The Event Object");
        console.log("returns the event object on $emit");
        (function () {
            //scope.$on("someEvent", function () { console.log("someEvent被触发"); });

            //var returnedEvent = scope.$emit("someEvent");

            //console.log(returnedEvent !== undefined);
            //console.log(returnedEvent.name === "someEvent");
        })();
        console.log("can be deregistered $emit");
        (function () {
            //var deregister = scope.$on("someEvent", function () { console.log("someEvent被触发"); });

            //deregister();

            //scope.$emit("someEvent");
        })();
        console.log("doesn't skip the next listener when removed on $emit");
        (function () {
            //var deregister;

            //var listener = function () {
            //    deregister();
            //};
            //var nextListener = function () {
            //    console.log("nextListener被触发");
            //};

            //deregister = scope.$on("someEvent", listener);
            //scope.$on("someEvent", nextListener);

            //scope.$emit("someEvent");
        })();
        console.log("Emitting Up The Scope Hierarchy");
        console.log("propagates up the scope hierarchy on $emit");
        (function () {
            //var parentListener = function () { console.log("parentListener被触发"); };
            //var scopeListener = function () { console.log("scopeListener被触发"); };

            //parent.$on("someEvent", parentListener);
            //scope.$on("someEvent", scopeListener);
            //scope.$emit("someEvent");
        })();
        console.log("propagates the same event up on $emit");
        (function () {
            //var parentListener = function () { console.log("parentListener被触发"); };
            //var scopeListener = function () { console.log("scopeListener被触发"); };

            //parent.$on("someEvent", parentListener);
            //scope.$on("someEvent", scopeListener);
            //scope.$emit("someEvent");
        })();
        console.log("Broadcasting Down The Scope Hierarchy");
        console.log("propagates down the scope hierarchy on $broadcast");
        (function () {
            //var scopeListener = function () { console.log("scopeListener被触发"); };
            //var childListener = function () { console.log("childListener被触发"); };
            //var isolatedListener = function () { console.log("isolatedListener被触发"); };

            //scope.$on("someEvent", scopeListener);
            //child.$on("someEvent", childListener);
            //isolatedChild.$on("someEvent", isolatedListener);

            //scope.$broadcast("someEvent");
        })();
        console.log("Including The Current And Target Scopes in The Event Object");
        console.log("attaches targetScope on $emit");
        (function () {
            //var scopeListener = function () { console.log("scopeListener被触发"); };
            //var parentListener = function () { console.log("parentListener被触发"); };

            //scope.$on("someEvent", scopeListener);
            //parent.$on("someEvent", parentListener);

            //scope.$emit("someEvent");
        })();
        console.log("attaches targetScope on $broadcast");
        (function () {
            //var scopeListener = function () { console.log("scopeListener被触发"); };
            //var childListener = function () { console.log("childListener被触发"); };

            //scope.$on("someEvent", scopeListener);
            //child.$on("someEvent", childListener);

            //scope.$broadcast("someEvent");
        })();
        console.log("attaches currentScope on $emit");
        (function () {
            //var currentScopeOnScope;
            //var currentScopeOnParent;
            //var scopeListener = function (event) {
            //    currentScopeOnScope = event.currentScope;
            //};
            //var parentListener = function (event) {
            //    currentScopeOnParent = event.currentScope;
            //};

            //scope.$on("someEvent", scopeListener);
            //parent.$on("someEvent", parentListener);

            //scope.$emit("someEvent");

            //console.log(currentScopeOnScope === scope);
            //console.log(currentScopeOnParent === parent);
        })();
        console.log("attaches currentScope on $broadcast");
        (function () {
            //var currentScopeOnScope;
            //var currentScopeOnChild;
            //var scopeListener = function (event) {
            //    currentScopeOnScope = event.currentScope;
            //};
            //var childListener = function (event) {
            //    currentScopeOnChild = event.currentScope;
            //};

            //scope.$on("someEvent", scopeListener);
            //child.$on("someEvent", childListener);

            //scope.$broadcast("someEvent");

            //console.log(currentScopeOnScope === scope);
            //console.log(currentScopeOnChild === child);
        })();
        console.log("sets currentScope to null after propagation on $emit");
        (function () {
            //var event;
            //var scopeListener = function (evt) {
            //    event = evt;
            //    console.log(event.currentScope);
            //};
            //scope.$on("someEvent", scopeListener);

            //scope.$emit("someEvent");

            //console.log(event.currentScope == null);
        })();
        console.log("sets currentScope to null after propagation on $broadcast");
        (function () {
            //var event;
            //var scopeListener = function (evt) {
            //    event = evt;
            //    console.log(event);
            //};
            //scope.$on("someEvent", scopeListener);

            //scope.$broadcast("someEvent");

            //console.log(event.currentScope == null);
        })();
        console.log("doesn't propagate to parents when stopped");
        (function () {
            //var scopeListener = function (event) {
            //    event.stopPropagation();
            //};
            //var parentListener = function () {
            //    console.log("parentListener");
            //};

            //scope.$on("someEvent", scopeListener);
            //parent.$on("someEvent", parentListener);

            //scope.$emit("someEvent");
        })();
        console.log("is received by listeners on current scope after being stopped");
        (function () {
            //var listener1 = function (event) {
            //    event.stopPropagation();
            //};
            //var listener2 = function () {
            //    console.log("listener2");
            //};

            //scope.$on("someEvent", listener1);
            //scope.$on("someEvent", listener2);

            //scope.$emit("someEvent");
        })();
        console.log("is sets defaultPrevented when preventDefault called on $broadcast");
        (function () {
            //var listener = function (event) {
            //    event.preventDefault();
            //};
            //scope.$on("someEvent", listener);

            //var event = scope.$broadcast("someEvent");

            //console.log(event.defaultPrevented === true);
        })();
        console.log("Broadcasting Scope Removal");
        console.log("fires $destroy when destroyed");
        (function () {
            //var listener = function () { console.log("listener"); };
            //scope.$on("$destroy", listener);

            //scope.$destroy();
        })();
        console.log("fires $destroy on children destroyed");
        (function () {
            //var listener = function () { console.log("listner"); };
            //child.$on("$destroy", listener);

            //scope.$destroy();
        })();
        console.log("Disabling Listeners On Destroyed Scopes");
        console.log("no longers calls listeners after destroyed");
        (function () {
            //var listener = function () { console.log("listener"); };
            //scope.$on("myEvent", listener);

            //scope.$destroy();

            //scope.$emit("myEvent");
        })();
        console.log("Handling Exceptions");
        console.log("doesn't stop on exceptions on $broadcast");
        (function () {
            var listener1 = function () {
                throw "listener1 error";
            };
            var listener2 = function () {
                console.log("listener2");
            };
            scope.$on("someEvent", listener1);
            scope.$on("someEvent", listener2);

            scope.$broadcast("someEvent");
        })();
    </script>
</head>
<body>
</body>
</html>
