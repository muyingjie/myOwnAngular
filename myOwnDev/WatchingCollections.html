<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Watching Collections</title>
    <script src="jquery-2.2.0.js"></script>
    <script src="lodash.js"></script>
    <script src="myAngular.js"></script>
    <script src="lodashExtension.js"></script>
    <script>
        var scope = new Scope();
        console.log("Setting Up The Infrastructure");
        console.log("$watchCollections");
        console.log("Detecting Non-Collection Changes");
        console.log("works like a normal watch for non-collections");
        (function () {
            //var valueProvided;

            //scope.aValue = 42;
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.aValue; },
            //    function (newValue, oldValue, scope) {
            //        valueProvided = newValue;
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);
            //console.log(valueProvided === scope.aValue);

            //scope.aValue = 43;
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("works like a normal watch for NaNs");
        (function () {
            //scope.aValue = 0 / 0;
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.aValue; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.$digest();
            //console.log(scope.counter === 1);
        })();
        console.log("Detecting New Arrays");
        console.log("notices when the value becomes an array");
        (function () {
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arr; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.arr = [1, 2, 3];
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("Detecting New Or Removed Items in Arrays");
        console.log("notices an item added to an array");
        (function () {
            //scope.arr = [1, 2, 3];
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arr;},
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.arr.push(4);
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("notices an item removed from an array");
        (function () {
            //scope.arr = [1, 2, 3];
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arr;},
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.arr.shift();
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("Detecting Relpaced or Reordered Items in Arrays");
        console.log("notices an item replaced in an array");
        (function () {
            //scope.arr = [1, 2, 3];
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arr; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.arr[1] = 42;
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("notices items reordered in an array");
        (function () {
            //scope.arr = [2, 1, 3];
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arr; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.arr.sort();
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("doesn't fail on NaNs in arrays");
        (function () {
            //scope.arr = [2, NaN, 3];
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arr; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);
        })();
        console.log("notices an item replaced in an arguments object");
        (function () {
            //(function () {
            //    scope.arrayLike = arguments;
            //})(1, 2, 3);
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arrayLike; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.arrayLike[1] = 42;
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("notices an item replaced in a NodeList object");
        (function () {
            //document.documentElement.appendChild(document.createElement("div"));
            //scope.arrayLike = document.getElementsByTagName("div");

            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.arrayLike; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //document.documentElement.appendChild(document.createElement("div"));
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("Detecting New Objects");
        console.log("notices when the value becomes an object");
        (function () {
            //scope.counter = 0;

            //scope.$watchCollection(
            //    function (scope) { return scope.obj; },
            //    function (newValue, oldValue, scope) {
            //        scope.counter++;
            //    }
            //);

            //scope.$digest();
            //console.log(scope.counter === 1);

            //scope.obj = { a: 1 };
            //scope.$digest();
            //console.log(scope.counter === 2);

            //scope.$digest();
            //console.log(scope.counter === 2);
        })();
        console.log("Detecting New Or Replaced Attributes in Objects");
        console.log("notices when an attribute is added to an object");
        (function () {
            scope.counter = 0;
            scope.obj = { a: 1 };

            scope.$watchCollection(
                function (scope) { return scope.obj; },
                function (newValue, oldValue, scope) {
                    scope.counter++;
                }
            );

            scope.$digest();
            console.log(scope.counter === 1);

            scope.obj.b = 2;
            scope.$digest();
            console.log(scope.counter === 2);

            scope.$digest();
            console.log(scope.counter === 2);
        })();
        console.log("notices when an attribute is changed in an object");
        (function () {
            scope.counter = 0;
            scope.obj = { a: 1 };

            scope.$watchCollection(
                function (scope) { return scope.obj;},
                function (newValue, oldValue, scope) {
                    scope.counter++;
                }
            );

            scope.$digest();
            console.log(scope.counter === 1);

            scope.obj.a = 2;
            scope.$digest();
            console.log(scope.counter === 2);

            scope.$digest();
            console.log(scope.counter === 2);
        })();
    </script>
</head>

<body>
</body>
</html>
